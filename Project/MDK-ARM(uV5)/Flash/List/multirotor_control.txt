; generated by Component: ARM Compiler 5.05 update 1 (build 106) Tool: ArmCC [4d0efa]
; commandline ArmCC [--c99 --list --split_sections --debug -c --asm --interleave -o.\flash\obj\multirotor_control.o --asm_dir=.\Flash\List\ --list_dir=.\Flash\List\ --depend=.\flash\obj\multirotor_control.d --cpu=Cortex-M3 --apcs=interwork -O0 --diag_suppress=9931 -I..\..\Libraries\CMSIS\CM3\CoreSupport -I..\..\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x -I..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\Libraries\STM32_USB-FS-Device_Driver\inc -I..\..\User\usb_virture_com -I..\..\User -I..\..\User\bsp -I..\..\User\Driver\IIC -I..\..\User\Driver\LED -I..\..\User\Driver\TIM -I..\..\User\Driver\Delay -I..\..\User\Driver\UART -I..\..\User\Driver\MOTOR -I..\..\User\Driver\PWM_IN -I..\..\User\Driver\EEPROM -I..\..\User\Algorithm\Algorithm_filter -I..\..\User\Algorithm\Algorithm_math -I..\..\User\Algorithm\Algorithm_sqLite -I..\..\User\Algorithm\Algorithm_quaternion -I..\..\User\Function\MultiRotor_rc -I..\..\User\Function\MultiRotor_app -I..\..\User\Function\MultiRotor_ahrs -I..\..\User\Function\MultiRotor_radio -I..\..\User\Function\MultiRotor_control -I..\..\User\Driver\STMFLASH -I..\..\User\Function\MultiRotor_altitute -I..\..\User\Modules\Modules_ultrasonic -I..\..\User\ANO_DT -I..\..\User\Driver\Modules_hmc5883 -I..\..\User\Driver\Modules_mpu6050 -I..\..\User\Driver\Modules_ms5611 -I..\..\User\Driver\Modules_oled -I..\..\User\Driver\Modules_ultrasonic -I..\..\User\Function\Heigh -I"C:\Users\Administrator\Desktop\机器人课飞控\机器人课无人机原始程序 - 副本\Project\MDK-ARM(uV5)\RTE" -IC:\Keil_v5\ARM\PACK\Keil\STM32F1xx_DFP\1.0.5\Device\Include -IC:\Keil_v5\ARM\CMSIS\Include -D__MICROLIB -D__UVISION_VERSION=514 -DSTM32F10X_HD -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER --omf_browse=.\flash\obj\multirotor_control.crf ..\..\User\Function\MultiRotor_control\MultiRotor_control.c]
                          THUMB

                          AREA ||i.Attitude_RatePID||, CODE, READONLY, ALIGN=2

                  Attitude_RatePID PROC
;;;110    /*====================================================================================================*/
;;;111    void Attitude_RatePID(void)
000000  e92d4ffe          PUSH     {r1-r11,lr}
;;;112    {
;;;113      fp32 E_pitch,E_roll,E_yaw;
;;;114    	
;;;115    	// 计算偏差  
;;;116    	E_pitch = ctrl.pitch.shell.pid_out - sensor.gyro.averag.y;
000004  4a9a              LDR      r2,|L1.624|
000006  6c11              LDR      r1,[r2,#0x40]
000008  4a9a              LDR      r2,|L1.628|
00000a  6a50              LDR      r0,[r2,#0x24]
00000c  f7fffffe          BL       __aeabi_fsub
000010  9002              STR      r0,[sp,#8]
;;;117    	E_roll  = ctrl.roll.shell.pid_out  - sensor.gyro.averag.x;
000012  4a97              LDR      r2,|L1.624|
000014  6bd1              LDR      r1,[r2,#0x3c]
000016  4a97              LDR      r2,|L1.628|
000018  6ed0              LDR      r0,[r2,#0x6c]
00001a  f7fffffe          BL       __aeabi_fsub
00001e  9001              STR      r0,[sp,#4]
;;;118    	E_yaw   = ctrl.yaw.shell.pid_out   - sensor.gyro.averag.z;
000020  4a93              LDR      r2,|L1.624|
000022  6c51              LDR      r1,[r2,#0x44]
000024  4a93              LDR      r2,|L1.628|
000026  f8d200b4          LDR      r0,[r2,#0xb4]
00002a  f7fffffe          BL       __aeabi_fsub
00002e  9000              STR      r0,[sp,#0]
;;;119    	
;;;120    	// 积分
;;;121    	ctrl.pitch.core.increment += E_pitch;
000030  4990              LDR      r1,|L1.628|
000032  6b48              LDR      r0,[r1,#0x34]
000034  9902              LDR      r1,[sp,#8]
000036  f7fffffe          BL       __aeabi_fadd
00003a  4601              MOV      r1,r0
00003c  488d              LDR      r0,|L1.628|
00003e  6341              STR      r1,[r0,#0x34]
;;;122    	ctrl.roll.core.increment  += E_roll;
000040  4601              MOV      r1,r0
000042  6fc8              LDR      r0,[r1,#0x7c]
000044  9901              LDR      r1,[sp,#4]
000046  f7fffffe          BL       __aeabi_fadd
00004a  4601              MOV      r1,r0
00004c  4889              LDR      r0,|L1.628|
00004e  67c1              STR      r1,[r0,#0x7c]
;;;123    	ctrl.yaw.core.increment   += E_yaw;
000050  4601              MOV      r1,r0
000052  f8d100c4          LDR      r0,[r1,#0xc4]
000056  9900              LDR      r1,[sp,#0]
000058  f7fffffe          BL       __aeabi_fadd
00005c  4601              MOV      r1,r0
00005e  4885              LDR      r0,|L1.628|
000060  f8c010c4          STR      r1,[r0,#0xc4]
;;;124    	
;;;125    	// 积分限幅
;;;126    	ctrl.pitch.core.increment = data_limit(ctrl.pitch.core.increment,20,-20);
000064  4601              MOV      r1,r0
000066  4a84              LDR      r2,|L1.632|
000068  6b48              LDR      r0,[r1,#0x34]
00006a  4984              LDR      r1,|L1.636|
00006c  f7fffffe          BL       data_limit
000070  4601              MOV      r1,r0
000072  4880              LDR      r0,|L1.628|
000074  6341              STR      r1,[r0,#0x34]
;;;127    	ctrl.roll.core.increment  = data_limit(ctrl.roll.core.increment,20,-20);		
000076  4601              MOV      r1,r0
000078  4a7f              LDR      r2,|L1.632|
00007a  6fc8              LDR      r0,[r1,#0x7c]
00007c  497f              LDR      r1,|L1.636|
00007e  f7fffffe          BL       data_limit
000082  4601              MOV      r1,r0
000084  487b              LDR      r0,|L1.628|
000086  67c1              STR      r1,[r0,#0x7c]
;;;128    	ctrl.yaw.core.increment   = data_limit(ctrl.yaw.core.increment,20,-20);
000088  4601              MOV      r1,r0
00008a  4a7b              LDR      r2,|L1.632|
00008c  f8d100c4          LDR      r0,[r1,#0xc4]
000090  497a              LDR      r1,|L1.636|
000092  f7fffffe          BL       data_limit
000096  4601              MOV      r1,r0
000098  4876              LDR      r0,|L1.628|
00009a  f8c010c4          STR      r1,[r0,#0xc4]
;;;129    	
;;;130    	ctrl.pitch.core.kp_out = ctrl.pitch.core.kp * E_pitch;
00009e  4601              MOV      r1,r0
0000a0  6a88              LDR      r0,[r1,#0x28]
0000a2  9902              LDR      r1,[sp,#8]
0000a4  f7fffffe          BL       __aeabi_fmul
0000a8  4601              MOV      r1,r0
0000aa  4872              LDR      r0,|L1.628|
0000ac  63c1              STR      r1,[r0,#0x3c]
;;;131    	ctrl.roll.core.kp_out  = ctrl.roll.core.kp  * E_roll;
0000ae  4601              MOV      r1,r0
0000b0  6f08              LDR      r0,[r1,#0x70]
0000b2  9901              LDR      r1,[sp,#4]
0000b4  f7fffffe          BL       __aeabi_fmul
0000b8  4601              MOV      r1,r0
0000ba  486e              LDR      r0,|L1.628|
0000bc  f8c01084          STR      r1,[r0,#0x84]
;;;132    	ctrl.yaw.core.kp_out   = ctrl.yaw.core.kp   * E_yaw;
0000c0  4601              MOV      r1,r0
0000c2  f8d100b8          LDR      r0,[r1,#0xb8]
0000c6  9900              LDR      r1,[sp,#0]
0000c8  f7fffffe          BL       __aeabi_fmul
0000cc  4601              MOV      r1,r0
0000ce  4869              LDR      r0,|L1.628|
0000d0  f8c010cc          STR      r1,[r0,#0xcc]
;;;133    	
;;;134    	ctrl.pitch.core.ki_out = ctrl.pitch.core.ki * ctrl.pitch.core.increment;
0000d4  4602              MOV      r2,r0
0000d6  6b51              LDR      r1,[r2,#0x34]
0000d8  6ad0              LDR      r0,[r2,#0x2c]
0000da  f7fffffe          BL       __aeabi_fmul
0000de  4601              MOV      r1,r0
0000e0  4864              LDR      r0,|L1.628|
0000e2  6401              STR      r1,[r0,#0x40]
;;;135      ctrl.roll.core.ki_out  = ctrl.roll.core.ki  * ctrl.roll.core.increment;
0000e4  4602              MOV      r2,r0
0000e6  6fd1              LDR      r1,[r2,#0x7c]
0000e8  6f50              LDR      r0,[r2,#0x74]
0000ea  f7fffffe          BL       __aeabi_fmul
0000ee  4601              MOV      r1,r0
0000f0  4860              LDR      r0,|L1.628|
0000f2  f8c01088          STR      r1,[r0,#0x88]
;;;136    	ctrl.yaw.core.ki_out   = ctrl.yaw.core.ki   * ctrl.yaw.core.increment;
0000f6  4602              MOV      r2,r0
0000f8  f8d210c4          LDR      r1,[r2,#0xc4]
0000fc  f8d200bc          LDR      r0,[r2,#0xbc]
000100  f7fffffe          BL       __aeabi_fmul
000104  4601              MOV      r1,r0
000106  485b              LDR      r0,|L1.628|
000108  f8c010d0          STR      r1,[r0,#0xd0]
;;;137    	
;;;138    	// 微分
;;;139    	ctrl.pitch.core.kd_out = ctrl.pitch.core.kd * (sensor.gyro.histor.y - sensor.gyro.averag.y)*33;
00010c  4a58              LDR      r2,|L1.624|
00010e  6c11              LDR      r1,[r2,#0x40]
000110  6cd0              LDR      r0,[r2,#0x4c]
000112  f7fffffe          BL       __aeabi_fsub
000116  4605              MOV      r5,r0
000118  4856              LDR      r0,|L1.628|
00011a  6b01              LDR      r1,[r0,#0x30]
00011c  4628              MOV      r0,r5
00011e  f7fffffe          BL       __aeabi_fmul
000122  4604              MOV      r4,r0
000124  4956              LDR      r1,|L1.640|
000126  f7fffffe          BL       __aeabi_fmul
00012a  4601              MOV      r1,r0
00012c  4851              LDR      r0,|L1.628|
00012e  6441              STR      r1,[r0,#0x44]
;;;140    	ctrl.roll.core.kd_out  = ctrl.roll.core.kd  * (sensor.gyro.histor.x - sensor.gyro.averag.x)*33;
000130  4a4f              LDR      r2,|L1.624|
000132  6bd1              LDR      r1,[r2,#0x3c]
000134  6c90              LDR      r0,[r2,#0x48]
000136  f7fffffe          BL       __aeabi_fsub
00013a  4605              MOV      r5,r0
00013c  484d              LDR      r0,|L1.628|
00013e  6f81              LDR      r1,[r0,#0x78]
000140  4628              MOV      r0,r5
000142  f7fffffe          BL       __aeabi_fmul
000146  4604              MOV      r4,r0
000148  494d              LDR      r1,|L1.640|
00014a  f7fffffe          BL       __aeabi_fmul
00014e  4601              MOV      r1,r0
000150  4848              LDR      r0,|L1.628|
000152  f8c0108c          STR      r1,[r0,#0x8c]
;;;141    	ctrl.yaw.core.kd_out   = ctrl.yaw.core.kd   * (sensor.gyro.histor.z - sensor.gyro.averag.z)*33;	
000156  4a46              LDR      r2,|L1.624|
000158  6c51              LDR      r1,[r2,#0x44]
00015a  6d10              LDR      r0,[r2,#0x50]
00015c  f7fffffe          BL       __aeabi_fsub
000160  4605              MOV      r5,r0
000162  4844              LDR      r0,|L1.628|
000164  f8d010c0          LDR      r1,[r0,#0xc0]
000168  4628              MOV      r0,r5
00016a  f7fffffe          BL       __aeabi_fmul
00016e  4604              MOV      r4,r0
000170  4943              LDR      r1,|L1.640|
000172  f7fffffe          BL       __aeabi_fmul
000176  4601              MOV      r1,r0
000178  483e              LDR      r0,|L1.628|
00017a  f8c010d4          STR      r1,[r0,#0xd4]
;;;142    	
;;;143    	sensor.gyro.histor.y = sensor.gyro.averag.y;
00017e  483c              LDR      r0,|L1.624|
000180  6c01              LDR      r1,[r0,#0x40]
000182  64c1              STR      r1,[r0,#0x4c]
;;;144    	sensor.gyro.histor.x = sensor.gyro.averag.x; 
000184  6bc1              LDR      r1,[r0,#0x3c]
000186  6481              STR      r1,[r0,#0x48]
;;;145      sensor.gyro.histor.z = sensor.gyro.averag.z;	
000188  6c41              LDR      r1,[r0,#0x44]
00018a  6501              STR      r1,[r0,#0x50]
;;;146    	
;;;147    	ctrl.pitch.core.pid_out = ctrl.pitch.core.kp_out + ctrl.pitch.core.ki_out + ctrl.pitch.core.kd_out;
00018c  4a39              LDR      r2,|L1.628|
00018e  6c11              LDR      r1,[r2,#0x40]
000190  6bd0              LDR      r0,[r2,#0x3c]
000192  f7fffffe          BL       __aeabi_fadd
000196  4604              MOV      r4,r0
000198  4836              LDR      r0,|L1.628|
00019a  6c41              LDR      r1,[r0,#0x44]
00019c  4620              MOV      r0,r4
00019e  f7fffffe          BL       __aeabi_fadd
0001a2  4601              MOV      r1,r0
0001a4  4833              LDR      r0,|L1.628|
0001a6  6481              STR      r1,[r0,#0x48]
;;;148    	ctrl.roll.core.pid_out  = ctrl.roll.core.kp_out  + ctrl.roll.core.ki_out  + ctrl.roll.core.kd_out;
0001a8  4602              MOV      r2,r0
0001aa  f8d21088          LDR      r1,[r2,#0x88]
0001ae  f8d20084          LDR      r0,[r2,#0x84]
0001b2  f7fffffe          BL       __aeabi_fadd
0001b6  4604              MOV      r4,r0
0001b8  482e              LDR      r0,|L1.628|
0001ba  f8d0108c          LDR      r1,[r0,#0x8c]
0001be  4620              MOV      r0,r4
0001c0  f7fffffe          BL       __aeabi_fadd
0001c4  4601              MOV      r1,r0
0001c6  482b              LDR      r0,|L1.628|
0001c8  f8c01090          STR      r1,[r0,#0x90]
;;;149    	ctrl.yaw.core.pid_out   = ctrl.yaw.core.kp_out   + ctrl.yaw.core.kd_out;
0001cc  4602              MOV      r2,r0
0001ce  f8d210d4          LDR      r1,[r2,#0xd4]
0001d2  f8d200cc          LDR      r0,[r2,#0xcc]
0001d6  f7fffffe          BL       __aeabi_fadd
0001da  4601              MOV      r1,r0
0001dc  4825              LDR      r0,|L1.628|
0001de  f8c010d8          STR      r1,[r0,#0xd8]
;;;150    	
;;;151    	ctrl.pitch.core.pid_out = ctrl.pitch.core.pid_out*0.8 + ctrl.pitch.shell.pid_out/2;
0001e2  4601              MOV      r1,r0
0001e4  6a48              LDR      r0,[r1,#0x24]
0001e6  f04f4180          MOV      r1,#0x40000000
0001ea  f7fffffe          BL       __aeabi_fdiv
0001ee  4682              MOV      r10,r0
0001f0  f7fffffe          BL       __aeabi_f2d
0001f4  4606              MOV      r6,r0
0001f6  460f              MOV      r7,r1
0001f8  491e              LDR      r1,|L1.628|
0001fa  6c88              LDR      r0,[r1,#0x48]
0001fc  f7fffffe          BL       __aeabi_f2d
000200  4682              MOV      r10,r0
000202  4a20              LDR      r2,|L1.644|
000204  4b20              LDR      r3,|L1.648|
000206  f7fffffe          BL       __aeabi_dmul
00020a  4680              MOV      r8,r0
00020c  4632              MOV      r2,r6
00020e  463b              MOV      r3,r7
000210  f7fffffe          BL       __aeabi_dadd
000214  4604              MOV      r4,r0
000216  f7fffffe          BL       __aeabi_d2f
00021a  4601              MOV      r1,r0
00021c  4815              LDR      r0,|L1.628|
00021e  6481              STR      r1,[r0,#0x48]
;;;152    	ctrl.roll.core.pid_out  = ctrl.roll.core.pid_out *0.8 + ctrl.roll.shell.pid_out/2; 
000220  4601              MOV      r1,r0
000222  6ec8              LDR      r0,[r1,#0x6c]
000224  f04f4180          MOV      r1,#0x40000000
000228  f7fffffe          BL       __aeabi_fdiv
00022c  4680              MOV      r8,r0
00022e  f7fffffe          BL       __aeabi_f2d
000232  4604              MOV      r4,r0
000234  460d              MOV      r5,r1
000236  490f              LDR      r1,|L1.628|
000238  f8d10090          LDR      r0,[r1,#0x90]
00023c  f7fffffe          BL       __aeabi_f2d
000240  4680              MOV      r8,r0
000242  4a10              LDR      r2,|L1.644|
000244  4b10              LDR      r3,|L1.648|
000246  f7fffffe          BL       __aeabi_dmul
00024a  4606              MOV      r6,r0
00024c  4622              MOV      r2,r4
00024e  462b              MOV      r3,r5
000250  f7fffffe          BL       __aeabi_dadd
000254  4682              MOV      r10,r0
000256  f7fffffe          BL       __aeabi_d2f
00025a  4601              MOV      r1,r0
00025c  4805              LDR      r0,|L1.628|
00025e  f8c01090          STR      r1,[r0,#0x90]
;;;153    	ctrl.yaw.core.pid_out   = ctrl.yaw.core.pid_out;
000262  f8d010d8          LDR      r1,[r0,#0xd8]
000266  f8c010d8          STR      r1,[r0,#0xd8]
;;;154    
;;;155    }
00026a  e8bd8ffe          POP      {r1-r11,pc}
;;;156    /*====================================================================================================*/
                          ENDP

00026e  0000              DCW      0x0000
                  |L1.624|
                          DCD      sensor
                  |L1.628|
                          DCD      ctrl
                  |L1.632|
                          DCD      0xc1a00000
                  |L1.636|
                          DCD      0x41a00000
                  |L1.640|
                          DCD      0x42040000
                  |L1.644|
                          DCD      0x9999999a
                  |L1.648|
                          DCD      0x3fe99999

                          AREA ||i.CONTROL||, CODE, READONLY, ALIGN=2

                  CONTROL PROC
;;;60     /*====================================================================================================*/
;;;61     void CONTROL(struct _target Goal)   
000000  e92d41ff          PUSH     {r0-r8,lr}
;;;62     {
;;;63     	float  deviation_pitch,deviation_roll,deviation_yaw;
;;;64     	
;;;65     			if(ctrl.ctrlRate >= 2)
000004  4860              LDR      r0,|L2.392|
000006  7800              LDRB     r0,[r0,#0]  ; ctrl
000008  2802              CMP      r0,#2
00000a  db7d              BLT      |L2.264|
;;;66     			{///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////;;;67     				//*****************外环(角度环)PID**************************//
;;;68     				//横滚计算///////////////
;;;69     				deviation_pitch = Goal.Pitch - AngE.Pitch;  	//deviation：偏离，increment：增量
00000c  4a5f              LDR      r2,|L2.396|
00000e  6811              LDR      r1,[r2,#0]  ; AngE
000010  9800              LDR      r0,[sp,#0]
000012  f7fffffe          BL       __aeabi_fsub
000016  4606              MOV      r6,r0
;;;70     				ctrl.pitch.shell.increment += deviation_pitch;
000018  495b              LDR      r1,|L2.392|
00001a  6908              LDR      r0,[r1,#0x10]
00001c  4631              MOV      r1,r6
00001e  f7fffffe          BL       __aeabi_fadd
000022  4959              LDR      r1,|L2.392|
000024  6108              STR      r0,[r1,#0x10]
;;;71     				
;;;72     				//limit for the max increment
;;;73     				ctrl.pitch.shell.increment = data_limit(ctrl.pitch.shell.increment,ctrl.pitch.shell.increment_max,-ctrl.pitch.shell.increment_max);
000026  4608              MOV      r0,r1
000028  6940              LDR      r0,[r0,#0x14]
00002a  f0804500          EOR      r5,r0,#0x80000000
00002e  460a              MOV      r2,r1
000030  6951              LDR      r1,[r2,#0x14]
000032  6910              LDR      r0,[r2,#0x10]
000034  462a              MOV      r2,r5
000036  f7fffffe          BL       data_limit
00003a  4953              LDR      r1,|L2.392|
00003c  6108              STR      r0,[r1,#0x10]
;;;74     
;;;75     				ctrl.pitch.shell.pid_out = ctrl.pitch.shell.kp * deviation_pitch + ctrl.pitch.shell.ki * ctrl.pitch.shell.increment;
00003e  460a              MOV      r2,r1
000040  6911              LDR      r1,[r2,#0x10]
000042  6890              LDR      r0,[r2,#8]
000044  f7fffffe          BL       __aeabi_fmul
000048  4605              MOV      r5,r0
00004a  494f              LDR      r1,|L2.392|
00004c  6848              LDR      r0,[r1,#4]  ; ctrl
00004e  4631              MOV      r1,r6
000050  f7fffffe          BL       __aeabi_fmul
000054  4680              MOV      r8,r0
000056  4629              MOV      r1,r5
000058  f7fffffe          BL       __aeabi_fadd
00005c  494a              LDR      r1,|L2.392|
00005e  6248              STR      r0,[r1,#0x24]
;;;76     				
;;;77     				//俯仰计算//////////////
;;;78     				deviation_roll = Goal.Roll - AngE.Roll;
000060  4a4a              LDR      r2,|L2.396|
000062  6851              LDR      r1,[r2,#4]  ; AngE
000064  9801              LDR      r0,[sp,#4]
000066  f7fffffe          BL       __aeabi_fsub
00006a  4607              MOV      r7,r0
;;;79     				ctrl.roll.shell.increment += deviation_roll;
00006c  4946              LDR      r1,|L2.392|
00006e  6d88              LDR      r0,[r1,#0x58]
000070  4639              MOV      r1,r7
000072  f7fffffe          BL       __aeabi_fadd
000076  4944              LDR      r1,|L2.392|
000078  6588              STR      r0,[r1,#0x58]
;;;80     				
;;;81     				//limit for the max increment
;;;82     				ctrl.roll.shell.increment = data_limit(ctrl.roll.shell.increment,ctrl.roll.shell.increment_max,-ctrl.roll.shell.increment_max);
00007a  4608              MOV      r0,r1
00007c  6dc0              LDR      r0,[r0,#0x5c]
00007e  f0804500          EOR      r5,r0,#0x80000000
000082  460a              MOV      r2,r1
000084  6dd1              LDR      r1,[r2,#0x5c]
000086  6d90              LDR      r0,[r2,#0x58]
000088  462a              MOV      r2,r5
00008a  f7fffffe          BL       data_limit
00008e  493e              LDR      r1,|L2.392|
000090  6588              STR      r0,[r1,#0x58]
;;;83     
;;;84     				ctrl.roll.shell.pid_out  = ctrl.roll.shell.kp * deviation_roll + ctrl.roll.shell.ki * ctrl.roll.shell.increment;
000092  460a              MOV      r2,r1
000094  6d91              LDR      r1,[r2,#0x58]
000096  6d10              LDR      r0,[r2,#0x50]
000098  f7fffffe          BL       __aeabi_fmul
00009c  4605              MOV      r5,r0
00009e  493a              LDR      r1,|L2.392|
0000a0  6cc8              LDR      r0,[r1,#0x4c]  ; ctrl
0000a2  4639              MOV      r1,r7
0000a4  f7fffffe          BL       __aeabi_fmul
0000a8  4680              MOV      r8,r0
0000aa  4629              MOV      r1,r5
0000ac  f7fffffe          BL       __aeabi_fadd
0000b0  4935              LDR      r1,|L2.392|
0000b2  66c8              STR      r0,[r1,#0x6c]
;;;85     				
;;;86     				//航向计算////////////
;;;87     				if((Goal.Yaw - AngE.Yaw)>180 || (Goal.Yaw - AngE.Yaw)<-180){
0000b4  4a35              LDR      r2,|L2.396|
0000b6  6891              LDR      r1,[r2,#8]  ; AngE
0000b8  9802              LDR      r0,[sp,#8]
0000ba  f7fffffe          BL       __aeabi_fsub
0000be  4605              MOV      r5,r0
0000c0  4933              LDR      r1,|L2.400|
0000c2  f7fffffe          BL       __aeabi_cfrcmple
0000c6  d309              BCC      |L2.220|
0000c8  4a30              LDR      r2,|L2.396|
0000ca  6891              LDR      r1,[r2,#8]  ; AngE
0000cc  9802              LDR      r0,[sp,#8]
0000ce  f7fffffe          BL       __aeabi_fsub
0000d2  4605              MOV      r5,r0
0000d4  492f              LDR      r1,|L2.404|
0000d6  f7fffffe          BL       __aeabi_cfcmple
0000da  d236              BCS      |L2.330|
                  |L2.220|
;;;88     					 if(Goal.Yaw>0 && AngE.Yaw<0)  deviation_yaw= (-180 - AngE.Yaw) +(Goal.Yaw - 180);
0000dc  2100              MOVS     r1,#0
0000de  9802              LDR      r0,[sp,#8]
0000e0  f7fffffe          BL       __aeabi_cfrcmple
0000e4  d216              BCS      |L2.276|
0000e6  4929              LDR      r1,|L2.396|
0000e8  6888              LDR      r0,[r1,#8]  ; AngE
0000ea  2100              MOVS     r1,#0
0000ec  f7fffffe          BL       __aeabi_cfcmple
0000f0  d210              BCS      |L2.276|
0000f2  4927              LDR      r1,|L2.400|
0000f4  9802              LDR      r0,[sp,#8]
0000f6  f7fffffe          BL       __aeabi_fsub
0000fa  4605              MOV      r5,r0
0000fc  4823              LDR      r0,|L2.396|
0000fe  6881              LDR      r1,[r0,#8]  ; AngE
000100  4824              LDR      r0,|L2.404|
000102  f7fffffe          BL       __aeabi_fsub
000106  e000              B        |L2.266|
                  |L2.264|
000108  e030              B        |L2.364|
                  |L2.266|
00010a  4680              MOV      r8,r0
00010c  4629              MOV      r1,r5
00010e  f7fffffe          BL       __aeabi_fadd
000112  4604              MOV      r4,r0
                  |L2.276|
;;;89     					 if(Goal.Yaw<0 && AngE.Yaw>0)  deviation_yaw= (180 - AngE.Yaw) +(Goal.Yaw + 180);
000114  2100              MOVS     r1,#0
000116  9802              LDR      r0,[sp,#8]
000118  f7fffffe          BL       __aeabi_cfcmple
00011c  d21b              BCS      |L2.342|
00011e  491b              LDR      r1,|L2.396|
000120  6888              LDR      r0,[r1,#8]  ; AngE
000122  2100              MOVS     r1,#0
000124  f7fffffe          BL       __aeabi_cfrcmple
000128  d215              BCS      |L2.342|
00012a  4919              LDR      r1,|L2.400|
00012c  9802              LDR      r0,[sp,#8]
00012e  f7fffffe          BL       __aeabi_fadd
000132  4605              MOV      r5,r0
000134  4815              LDR      r0,|L2.396|
000136  6881              LDR      r1,[r0,#8]  ; AngE
000138  4815              LDR      r0,|L2.400|
00013a  f7fffffe          BL       __aeabi_fsub
00013e  4680              MOV      r8,r0
000140  4629              MOV      r1,r5
000142  f7fffffe          BL       __aeabi_fadd
000146  4604              MOV      r4,r0
000148  e005              B        |L2.342|
                  |L2.330|
;;;90     				}
;;;91     				else  deviation_yaw = Goal.Yaw - AngE.Yaw;
00014a  4a10              LDR      r2,|L2.396|
00014c  6891              LDR      r1,[r2,#8]  ; AngE
00014e  9802              LDR      r0,[sp,#8]
000150  f7fffffe          BL       __aeabi_fsub
000154  4604              MOV      r4,r0
                  |L2.342|
;;;92     				
;;;93     				ctrl.yaw.shell.pid_out = ctrl.yaw.shell.kp * deviation_yaw;
000156  490c              LDR      r1,|L2.392|
000158  f8d10094          LDR      r0,[r1,#0x94]  ; ctrl
00015c  4621              MOV      r1,r4
00015e  f7fffffe          BL       __aeabi_fmul
000162  4909              LDR      r1,|L2.392|
000164  f8c100b4          STR      r0,[r1,#0xb4]
;;;94     				ctrl.ctrlRate = 0; 
000168  2000              MOVS     r0,#0
00016a  7008              STRB     r0,[r1,#0]
                  |L2.364|
;;;95     			}
;;;96     	ctrl.ctrlRate ++;
00016c  4806              LDR      r0,|L2.392|
00016e  7800              LDRB     r0,[r0,#0]  ; ctrl
000170  1c40              ADDS     r0,r0,#1
000172  4905              LDR      r1,|L2.392|
000174  7008              STRB     r0,[r1,#0]
;;;97       Attitude_RatePID();	//角速率控制PID
000176  f7fffffe          BL       Attitude_RatePID
;;;98     	Thr_Ctrl(TT);// 油门控制
00017a  4807              LDR      r0,|L2.408|
00017c  f7fffffe          BL       Thr_Ctrl
;;;99     	Motor_Conter();
000180  f7fffffe          BL       Motor_Conter
;;;100    }
000184  e8bd81ff          POP      {r0-r8,pc}
;;;101    
                          ENDP

                  |L2.392|
                          DCD      ctrl
                  |L2.396|
                          DCD      AngE
                  |L2.400|
                          DCD      0x43340000
                  |L2.404|
                          DCD      0xc3340000
                  |L2.408|
                          DCD      0x3b23d70a

                          AREA ||i.Calculate_Target||, CODE, READONLY, ALIGN=2

                  Calculate_Target PROC
;;;22     /*====================================================================================================*/
;;;23     void Calculate_Target(void) 
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;24     {
;;;25     	int16_t ftemp=0;
000004  2400              MOVS     r4,#0
;;;26     	Target.Pitch = (1519-RC_Data.PITCH)/(20 + 7*RC_Data.SENSITIVITY);//RC_Data.SENSITIVITY没有被赋值
000006  4840              LDR      r0,|L3.264|
000008  f9b00012          LDRSH    r0,[r0,#0x12]  ; RC_Data
00000c  f24051ef          MOV      r1,#0x5ef
000010  1a09              SUBS     r1,r1,r0
000012  483d              LDR      r0,|L3.264|
000014  f9b00018          LDRSH    r0,[r0,#0x18]  ; RC_Data
000018  ebc000c0          RSB      r0,r0,r0,LSL #3
00001c  3014              ADDS     r0,r0,#0x14
00001e  fb91f5f0          SDIV     r5,r1,r0
000022  4628              MOV      r0,r5
000024  f7fffffe          BL       __aeabi_i2f
000028  4938              LDR      r1,|L3.268|
00002a  6008              STR      r0,[r1,#0]  ; Target
;;;27     	Target.Roll = (RC_Data.ROLL-1519)/(20 + 7*RC_Data.SENSITIVITY);//1500可能不够妥，油门中点不一定是1500
00002c  4836              LDR      r0,|L3.264|
00002e  f9b00010          LDRSH    r0,[r0,#0x10]  ; RC_Data
000032  f2a050ef          SUB      r0,r0,#0x5ef
000036  4934              LDR      r1,|L3.264|
000038  f9b11018          LDRSH    r1,[r1,#0x18]  ; RC_Data
00003c  ebc101c1          RSB      r1,r1,r1,LSL #3
000040  3114              ADDS     r1,r1,#0x14
000042  fb90f5f1          SDIV     r5,r0,r1
000046  4628              MOV      r0,r5
000048  f7fffffe          BL       __aeabi_i2f
00004c  492f              LDR      r1,|L3.268|
00004e  6048              STR      r0,[r1,#4]  ; Target
;;;28     
;;;29       //目标航向控制。当油门大于最小检查值时，认为用户希望起飞。那么此时的航向做为目标航向
;;;30        if(RC_Data.THROTTLE > RC_MINCHECK ) {
000050  482d              LDR      r0,|L3.264|
000052  f9b00014          LDRSH    r0,[r0,#0x14]  ; RC_Data
000056  f5b06f96          CMP      r0,#0x4b0
00005a  dd0b              BLE      |L3.116|
;;;31           if(flag.LockYaw != 1){  
00005c  482c              LDR      r0,|L3.272|
00005e  7980              LDRB     r0,[r0,#6]  ; flag
000060  2801              CMP      r0,#1
000062  d00e              BEQ      |L3.130|
;;;32     				 flag.LockYaw = 1;
000064  2001              MOVS     r0,#1
000066  492a              LDR      r1,|L3.272|
000068  7188              STRB     r0,[r1,#6]
;;;33     	       Target.Yaw = AngE.Yaw; //将当前的航向做为目标航向，起飞的时候无人机的飞行方向与被放置的无人机方向一致
00006a  482a              LDR      r0,|L3.276|
00006c  6880              LDR      r0,[r0,#8]  ; AngE
00006e  4927              LDR      r1,|L3.268|
000070  6088              STR      r0,[r1,#8]  ; Target
000072  e006              B        |L3.130|
                  |L3.116|
;;;34           }
;;;35        }
;;;36        else {
;;;37     		 flag.LockYaw = 0;	
000074  2000              MOVS     r0,#0
000076  4926              LDR      r1,|L3.272|
000078  7188              STRB     r0,[r1,#6]
;;;38     		 Target.Yaw = AngE.Yaw;
00007a  4826              LDR      r0,|L3.276|
00007c  6880              LDR      r0,[r0,#8]  ; AngE
00007e  4923              LDR      r1,|L3.268|
000080  6088              STR      r0,[r1,#8]  ; Target
                  |L3.130|
;;;39     	 } 
;;;40     	//航向在中点设置一个死区，好处是手操作时忽略小动作
;;;41     	if((RC_Data.YAW > 1549)||(RC_Data.YAW < 1489)){
000082  4821              LDR      r0,|L3.264|
000084  f9b00016          LDRSH    r0,[r0,#0x16]  ; RC_Data
000088  f240610d          MOV      r1,#0x60d
00008c  4288              CMP      r0,r1
00008e  dc05              BGT      |L3.156|
000090  481d              LDR      r0,|L3.264|
000092  f9b00016          LDRSH    r0,[r0,#0x16]  ; RC_Data
000096  f5b06fba          CMP      r0,#0x5d0
00009a  dc32              BGT      |L3.258|
                  |L3.156|
;;;42     		ftemp = 1519 - RC_Data.YAW; 
00009c  481a              LDR      r0,|L3.264|
00009e  8ac0              LDRH     r0,[r0,#0x16]  ; RC_Data
0000a0  f24051ef          MOV      r1,#0x5ef
0000a4  1a08              SUBS     r0,r1,r0
0000a6  b204              SXTH     r4,r0
;;;43     	  Target.Yaw += (ftemp / 200.0f)*0.1f; 
0000a8  4620              MOV      r0,r4
0000aa  f7fffffe          BL       __aeabi_i2f
0000ae  4607              MOV      r7,r0
0000b0  4919              LDR      r1,|L3.280|
0000b2  f7fffffe          BL       __aeabi_fdiv
0000b6  4606              MOV      r6,r0
0000b8  4918              LDR      r1,|L3.284|
0000ba  f7fffffe          BL       __aeabi_fmul
0000be  4605              MOV      r5,r0
0000c0  4812              LDR      r0,|L3.268|
0000c2  6881              LDR      r1,[r0,#8]  ; Target
0000c4  4628              MOV      r0,r5
0000c6  f7fffffe          BL       __aeabi_fadd
0000ca  4910              LDR      r1,|L3.268|
0000cc  6088              STR      r0,[r1,#8]  ; Target
;;;44     		
;;;45     		//转[-180.0,+180.0]
;;;46     	  if(Target.Yaw >180.0f) Target.Yaw -= 360.0f;	
0000ce  6888              LDR      r0,[r1,#8]  ; Target
0000d0  4913              LDR      r1,|L3.288|
0000d2  f7fffffe          BL       __aeabi_cfrcmple
0000d6  d207              BCS      |L3.232|
0000d8  490c              LDR      r1,|L3.268|
0000da  6888              LDR      r0,[r1,#8]  ; Target
0000dc  4911              LDR      r1,|L3.292|
0000de  f7fffffe          BL       __aeabi_fsub
0000e2  490a              LDR      r1,|L3.268|
0000e4  6088              STR      r0,[r1,#8]  ; Target
0000e6  e00c              B        |L3.258|
                  |L3.232|
;;;47     	  else if(Target.Yaw <-180.0f)Target.Yaw += 360.0f;
0000e8  4908              LDR      r1,|L3.268|
0000ea  6888              LDR      r0,[r1,#8]  ; Target
0000ec  490e              LDR      r1,|L3.296|
0000ee  f7fffffe          BL       __aeabi_cfcmple
0000f2  d206              BCS      |L3.258|
0000f4  4905              LDR      r1,|L3.268|
0000f6  6888              LDR      r0,[r1,#8]  ; Target
0000f8  490a              LDR      r1,|L3.292|
0000fa  f7fffffe          BL       __aeabi_fadd
0000fe  4903              LDR      r1,|L3.268|
000100  6088              STR      r0,[r1,#8]  ; Target
                  |L3.258|
;;;48     	}
;;;49     		
;;;50     }
000102  e8bd81f0          POP      {r4-r8,pc}
;;;51     
                          ENDP

000106  0000              DCW      0x0000
                  |L3.264|
                          DCD      RC_Data
                  |L3.268|
                          DCD      Target
                  |L3.272|
                          DCD      flag
                  |L3.276|
                          DCD      AngE
                  |L3.280|
                          DCD      0x43480000
                  |L3.284|
                          DCD      0x3dcccccd
                  |L3.288|
                          DCD      0x43340000
                  |L3.292|
                          DCD      0x43b40000
                  |L3.296|
                          DCD      0xc3340000

                          AREA ||i.Motor_Conter||, CODE, READONLY, ALIGN=2

                  Motor_Conter PROC
;;;164    /*====================================================================================================*/
;;;165    void Motor_Conter(void)
000000  e92d4ff0          PUSH     {r4-r11,lr}
;;;166    {
000004  b08b              SUB      sp,sp,#0x2c
;;;167    	s16 pitch,roll,yaw;
;;;168    	
;;;169    		pitch = ctrl.pitch.core.pid_out;
000006  4992              LDR      r1,|L4.592|
000008  6c88              LDR      r0,[r1,#0x48]
00000a  f7fffffe          BL       __aeabi_f2iz
00000e  b204              SXTH     r4,r0
;;;170    		roll  = ctrl.roll.core.pid_out;    
000010  498f              LDR      r1,|L4.592|
000012  f8d10090          LDR      r0,[r1,#0x90]
000016  f7fffffe          BL       __aeabi_f2iz
00001a  fa0ff980          SXTH     r9,r0
;;;171    		yaw   = -ctrl.yaw.core.pid_out;
00001e  488c              LDR      r0,|L4.592|
000020  f8d000d8          LDR      r0,[r0,#0xd8]
000024  f0804500          EOR      r5,r0,#0x80000000
000028  4628              MOV      r0,r5
00002a  f7fffffe          BL       __aeabi_f2iz
00002e  fa0ffa80          SXTH     r10,r0
;;;172    	
;;;173      	if(flag.FlightMode==ULTRASONIC_High || flag.FlightMode==AUTO_High || flag.FlightMode==ACC_High  || flag.FlightMode==ATMOSPHERE_High){
000032  4888              LDR      r0,|L4.596|
000034  7cc0              LDRB     r0,[r0,#0x13]  ; flag
000036  2802              CMP      r0,#2
000038  d00b              BEQ      |L4.82|
00003a  4886              LDR      r0,|L4.596|
00003c  7cc0              LDRB     r0,[r0,#0x13]  ; flag
00003e  2804              CMP      r0,#4
000040  d007              BEQ      |L4.82|
000042  4884              LDR      r0,|L4.596|
000044  7cc0              LDRB     r0,[r0,#0x13]  ; flag
000046  2806              CMP      r0,#6
000048  d003              BEQ      |L4.82|
00004a  4882              LDR      r0,|L4.596|
00004c  7cc0              LDRB     r0,[r0,#0x13]  ; flag
00004e  2803              CMP      r0,#3
000050  d179              BNE      |L4.326|
                  |L4.82|
;;;174    			Moto_duty[0] = thr_value - pitch - roll + yaw;
000052  4650              MOV      r0,r10
000054  f7fffffe          BL       __aeabi_i2f
000058  4680              MOV      r8,r0
00005a  4648              MOV      r0,r9
00005c  f7fffffe          BL       __aeabi_i2f
000060  4683              MOV      r11,r0
000062  4620              MOV      r0,r4
000064  f7fffffe          BL       __aeabi_i2f
000068  9009              STR      r0,[sp,#0x24]
00006a  487b              LDR      r0,|L4.600|
00006c  6801              LDR      r1,[r0,#0]  ; thr_value
00006e  9809              LDR      r0,[sp,#0x24]
000070  f7fffffe          BL       __aeabi_frsub
000074  4607              MOV      r7,r0
000076  4659              MOV      r1,r11
000078  f7fffffe          BL       __aeabi_fsub
00007c  4606              MOV      r6,r0
00007e  4641              MOV      r1,r8
000080  f7fffffe          BL       __aeabi_fadd
000084  4605              MOV      r5,r0
000086  f7fffffe          BL       __aeabi_f2uiz
00008a  4974              LDR      r1,|L4.604|
00008c  8008              STRH     r0,[r1,#0]
;;;175    			Moto_duty[1] = thr_value - pitch + roll - yaw;
00008e  4650              MOV      r0,r10
000090  f7fffffe          BL       __aeabi_i2f
000094  4680              MOV      r8,r0
000096  4648              MOV      r0,r9
000098  f7fffffe          BL       __aeabi_i2f
00009c  9009              STR      r0,[sp,#0x24]
00009e  4620              MOV      r0,r4
0000a0  f7fffffe          BL       __aeabi_i2f
0000a4  4683              MOV      r11,r0
0000a6  486c              LDR      r0,|L4.600|
0000a8  6801              LDR      r1,[r0,#0]  ; thr_value
0000aa  4658              MOV      r0,r11
0000ac  f7fffffe          BL       __aeabi_frsub
0000b0  4607              MOV      r7,r0
0000b2  9909              LDR      r1,[sp,#0x24]
0000b4  f7fffffe          BL       __aeabi_fadd
0000b8  4606              MOV      r6,r0
0000ba  4641              MOV      r1,r8
0000bc  f7fffffe          BL       __aeabi_fsub
0000c0  4605              MOV      r5,r0
0000c2  f7fffffe          BL       __aeabi_f2uiz
0000c6  4965              LDR      r1,|L4.604|
0000c8  8048              STRH     r0,[r1,#2]
;;;176    			Moto_duty[2] = thr_value + pitch + roll + yaw;
0000ca  4650              MOV      r0,r10
0000cc  f7fffffe          BL       __aeabi_i2f
0000d0  9009              STR      r0,[sp,#0x24]
0000d2  4648              MOV      r0,r9
0000d4  f7fffffe          BL       __aeabi_i2f
0000d8  4680              MOV      r8,r0
0000da  4620              MOV      r0,r4
0000dc  f7fffffe          BL       __aeabi_i2f
0000e0  4683              MOV      r11,r0
0000e2  485d              LDR      r0,|L4.600|
0000e4  6801              LDR      r1,[r0,#0]  ; thr_value
0000e6  4658              MOV      r0,r11
0000e8  f7fffffe          BL       __aeabi_fadd
0000ec  4607              MOV      r7,r0
0000ee  4641              MOV      r1,r8
0000f0  f7fffffe          BL       __aeabi_fadd
0000f4  4606              MOV      r6,r0
0000f6  9909              LDR      r1,[sp,#0x24]
0000f8  f7fffffe          BL       __aeabi_fadd
0000fc  4605              MOV      r5,r0
0000fe  f7fffffe          BL       __aeabi_f2uiz
000102  4956              LDR      r1,|L4.604|
000104  8088              STRH     r0,[r1,#4]
;;;177    			Moto_duty[3] = thr_value + pitch - roll - yaw;
000106  4650              MOV      r0,r10
000108  f7fffffe          BL       __aeabi_i2f
00010c  9009              STR      r0,[sp,#0x24]
00010e  4648              MOV      r0,r9
000110  f7fffffe          BL       __aeabi_i2f
000114  4680              MOV      r8,r0
000116  4620              MOV      r0,r4
000118  f7fffffe          BL       __aeabi_i2f
00011c  4683              MOV      r11,r0
00011e  484e              LDR      r0,|L4.600|
000120  6801              LDR      r1,[r0,#0]  ; thr_value
000122  4658              MOV      r0,r11
000124  f7fffffe          BL       __aeabi_fadd
000128  4607              MOV      r7,r0
00012a  4641              MOV      r1,r8
00012c  f7fffffe          BL       __aeabi_fsub
000130  4606              MOV      r6,r0
000132  9909              LDR      r1,[sp,#0x24]
000134  f7fffffe          BL       __aeabi_fsub
000138  4605              MOV      r5,r0
00013a  f7fffffe          BL       __aeabi_f2uiz
00013e  4947              LDR      r1,|L4.604|
000140  80c8              STRH     r0,[r1,#6]
000142  e05c              B        |L4.510|
000144  e7ff              B        |L4.326|
                  |L4.326|
;;;178        }
;;;179        else	if(RC_Data.THROTTLE > RC_MINCHECK) {
000146  4846              LDR      r0,|L4.608|
000148  f9b00014          LDRSH    r0,[r0,#0x14]  ; RC_Data
00014c  f5b06f96          CMP      r0,#0x4b0
000150  dd4e              BLE      |L4.496|
;;;180    		  int date_throttle	= (RC_Data.THROTTLE-MINRCVALUE)/cos(AngE.Roll/RtA)/cos(AngE.Pitch/RtA);
000152  4944              LDR      r1,|L4.612|
000154  6808              LDR      r0,[r1,#0]  ; AngE
000156  f7fffffe          BL       __aeabi_f2d
00015a  4607              MOV      r7,r0
00015c  4a42              LDR      r2,|L4.616|
00015e  4b43              LDR      r3,|L4.620|
000160  f7fffffe          BL       __aeabi_ddiv
000164  4605              MOV      r5,r0
000166  f7fffffe          BL       ||cos||
00016a  e9cd0106          STRD     r0,r1,[sp,#0x18]
00016e  493d              LDR      r1,|L4.612|
000170  6848              LDR      r0,[r1,#4]  ; AngE
000172  f7fffffe          BL       __aeabi_f2d
000176  4605              MOV      r5,r0
000178  4a3b              LDR      r2,|L4.616|
00017a  4b3c              LDR      r3,|L4.620|
00017c  f7fffffe          BL       __aeabi_ddiv
000180  e9cd0100          STRD     r0,r1,[sp,#0]
000184  f7fffffe          BL       ||cos||
000188  4607              MOV      r7,r0
00018a  4688              MOV      r8,r1
00018c  4934              LDR      r1,|L4.608|
00018e  f9b11014          LDRSH    r1,[r1,#0x14]  ; RC_Data
000192  f2a14056          SUB      r0,r1,#0x456
000196  f7fffffe          BL       __aeabi_i2d
00019a  463a              MOV      r2,r7
00019c  4643              MOV      r3,r8
00019e  e9cd0102          STRD     r0,r1,[sp,#8]
0001a2  f7fffffe          BL       __aeabi_ddiv
0001a6  e9cd0104          STRD     r0,r1,[sp,#0x10]
0001aa  e9dd2306          LDRD     r2,r3,[sp,#0x18]
0001ae  f7fffffe          BL       __aeabi_ddiv
0001b2  e9cd0108          STRD     r0,r1,[sp,#0x20]
0001b6  f7fffffe          BL       __aeabi_d2iz
0001ba  4683              MOV      r11,r0
;;;181    		
;;;182    		#ifdef QUADROTOR //四轴无人机
;;;183    			Moto_duty[0] = date_throttle - pitch - roll + yaw;
0001bc  ebab0004          SUB      r0,r11,r4
0001c0  eba00009          SUB      r0,r0,r9
0001c4  4450              ADD      r0,r0,r10
0001c6  4925              LDR      r1,|L4.604|
0001c8  8008              STRH     r0,[r1,#0]
;;;184    			Moto_duty[1] = date_throttle - pitch + roll - yaw;
0001ca  ebab0004          SUB      r0,r11,r4
0001ce  4448              ADD      r0,r0,r9
0001d0  eba0000a          SUB      r0,r0,r10
0001d4  8048              STRH     r0,[r1,#2]
;;;185    			Moto_duty[2] = date_throttle + pitch + roll + yaw;
0001d6  eb0b0004          ADD      r0,r11,r4
0001da  4448              ADD      r0,r0,r9
0001dc  4450              ADD      r0,r0,r10
0001de  8088              STRH     r0,[r1,#4]
;;;186    			Moto_duty[3] = date_throttle + pitch - roll - yaw;
0001e0  eb0b0004          ADD      r0,r11,r4
0001e4  eba00009          SUB      r0,r0,r9
0001e8  eba0000a          SUB      r0,r0,r10
0001ec  80c8              STRH     r0,[r1,#6]
;;;187    		#elif defined HEXRCOPTER  //六轴无人机
;;;188    			Moto_duty[0] = date_throttle - pitch + 0.5*roll - yaw;
;;;189    			Moto_duty[1] = date_throttle         +     roll + yaw;
;;;190    			Moto_duty[2] = date_throttle + pitch + 0.5*roll - yaw;
;;;191    			Moto_duty[3] = date_throttle + pitch - 0.5*roll + yaw;	
;;;192    			Moto_duty[4] = date_throttle         -     roll - yaw;
;;;193    			Moto_duty[5] = date_throttle - pitch - 0.5*roll + yaw;	
;;;194    		#endif 	
;;;195    		}
0001ee  e006              B        |L4.510|
                  |L4.496|
;;;196    		else
;;;197    		{	
;;;198    			array_assign(&Moto_duty[0],IDLING,MOTOR_NUM);//马达输出200
0001f0  2204              MOVS     r2,#4
0001f2  21b4              MOVS     r1,#0xb4
0001f4  4819              LDR      r0,|L4.604|
0001f6  f7fffffe          BL       array_assign
;;;199    			Reset_Integral();//内环pid全部输出置0		
0001fa  f7fffffe          BL       Reset_Integral
                  |L4.510|
;;;200    		}
;;;201    		
;;;202    		if(flag.ARMED)
0001fe  4815              LDR      r0,|L4.596|
000200  7940              LDRB     r0,[r0,#5]  ; flag
000202  b1f8              CBZ      r0,|L4.580|
;;;203    		{	
;;;204    			#ifdef QUADROTOR 		//四轴无人机
;;;205    				if(Moto_duty[0]<IDLING)Moto_duty[0]=IDLING;
000204  4815              LDR      r0,|L4.604|
000206  8800              LDRH     r0,[r0,#0]  ; Moto_duty
000208  28b4              CMP      r0,#0xb4
00020a  da02              BGE      |L4.530|
00020c  20b4              MOVS     r0,#0xb4
00020e  4913              LDR      r1,|L4.604|
000210  8008              STRH     r0,[r1,#0]
                  |L4.530|
;;;206    				if(Moto_duty[1]<IDLING)Moto_duty[1]=IDLING;
000212  4812              LDR      r0,|L4.604|
000214  8840              LDRH     r0,[r0,#2]  ; Moto_duty
000216  28b4              CMP      r0,#0xb4
000218  da02              BGE      |L4.544|
00021a  20b4              MOVS     r0,#0xb4
00021c  490f              LDR      r1,|L4.604|
00021e  8048              STRH     r0,[r1,#2]
                  |L4.544|
;;;207    				if(Moto_duty[2]<IDLING)Moto_duty[2]=IDLING;
000220  480e              LDR      r0,|L4.604|
000222  8880              LDRH     r0,[r0,#4]  ; Moto_duty
000224  28b4              CMP      r0,#0xb4
000226  da02              BGE      |L4.558|
000228  20b4              MOVS     r0,#0xb4
00022a  490c              LDR      r1,|L4.604|
00022c  8088              STRH     r0,[r1,#4]
                  |L4.558|
;;;208    				if(Moto_duty[3]<IDLING)Moto_duty[3]=IDLING;
00022e  480b              LDR      r0,|L4.604|
000230  88c0              LDRH     r0,[r0,#6]  ; Moto_duty
000232  28b4              CMP      r0,#0xb4
000234  da02              BGE      |L4.572|
000236  20b4              MOVS     r0,#0xb4
000238  4908              LDR      r1,|L4.604|
00023a  80c8              STRH     r0,[r1,#6]
                  |L4.572|
;;;209    
;;;210    			#elif defined HEXRCOPTER		//六轴无人机
;;;211    				if(Moto_duty[0]<IDLING)Moto_duty[0]=IDLING;
;;;212    				if(Moto_duty[1]<IDLING)Moto_duty[1]=IDLING;
;;;213    				if(Moto_duty[2]<IDLING)Moto_duty[2]=IDLING;
;;;214    				if(Moto_duty[3]<IDLING)Moto_duty[3]=IDLING;
;;;215    				if(Moto_duty[4]<IDLING)Moto_duty[4]=IDLING;
;;;216    				if(Moto_duty[5]<IDLING)Moto_duty[5]=IDLING;
;;;217    			#endif 	
;;;218    
;;;219    			moto_PwmRflash(&Moto_duty[0]);//马达输出刷新，直接写PWM输出寄存器	
00023c  4807              LDR      r0,|L4.604|
00023e  f7fffffe          BL       moto_PwmRflash
000242  e001              B        |L4.584|
                  |L4.580|
;;;220    		}	
;;;221    		else            moto_STOP();//强制输出1000	
000244  f7fffffe          BL       moto_STOP
                  |L4.584|
;;;222    }
000248  b00b              ADD      sp,sp,#0x2c
00024a  e8bd8ff0          POP      {r4-r11,pc}
;;;223    
                          ENDP

00024e  0000              DCW      0x0000
                  |L4.592|
                          DCD      ctrl
                  |L4.596|
                          DCD      flag
                  |L4.600|
                          DCD      thr_value
                  |L4.604|
                          DCD      Moto_duty
                  |L4.608|
                          DCD      RC_Data
                  |L4.612|
                          DCD      AngE
                  |L4.616|
                          DCD      0x63cfb331
                  |L4.620|
                          DCD      0x404ca994

                          AREA ||i.Reset_Integral||, CODE, READONLY, ALIGN=2

                  Reset_Integral PROC
;;;232    /*====================================================================================================*/
;;;233    void Reset_Integral(void)
000000  2100              MOVS     r1,#0
;;;234    {
;;;235    	ctrl.pitch.shell.increment = 0;
000002  4804              LDR      r0,|L5.20|
000004  6101              STR      r1,[r0,#0x10]
;;;236    	ctrl.roll.shell.increment= 0;	
000006  6581              STR      r1,[r0,#0x58]
;;;237      ctrl.pitch.core.increment = 0;		
000008  6341              STR      r1,[r0,#0x34]
;;;238      ctrl.roll.core.increment = 0;		
00000a  67c1              STR      r1,[r0,#0x7c]
;;;239    	ctrl.yaw.core.increment = 0;
00000c  f8c010c4          STR      r1,[r0,#0xc4]
;;;240    }
000010  4770              BX       lr
;;;241    
                          ENDP

000012  0000              DCW      0x0000
                  |L5.20|
                          DCD      ctrl

                          AREA ||i.Thr_Ctrl||, CODE, READONLY, ALIGN=2

                  Thr_Ctrl PROC
;;;242    
;;;243    void Thr_Ctrl(float T)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;244    {
000004  4604              MOV      r4,r0
;;;245    ///////////////////////////////////////////////////////////////////////////		
;;;246    	static float thr;
;;;247    	static float Thr_tmp;
;;;248    	thr = RC_Data.THROTTLE-1110; //油门值thr 0 ~ 1000
000006  4935              LDR      r1,|L6.220|
000008  f9b11014          LDRSH    r1,[r1,#0x14]  ; RC_Data
00000c  f2a14056          SUB      r0,r1,#0x456
000010  f7fffffe          BL       __aeabi_i2f
000014  4932              LDR      r1,|L6.224|
000016  6008              STR      r0,[r1,#0]  ; thr
;;;249    	Thr_tmp += 10 *3.14f *T *(thr/250.0f - Thr_tmp); //低通滤波
000018  4932              LDR      r1,|L6.228|
00001a  4831              LDR      r0,|L6.224|
00001c  6800              LDR      r0,[r0,#0]  ; thr
00001e  f7fffffe          BL       __aeabi_fdiv
000022  4680              MOV      r8,r0
000024  4830              LDR      r0,|L6.232|
000026  6801              LDR      r1,[r0,#0]  ; Thr_tmp
000028  4640              MOV      r0,r8
00002a  f7fffffe          BL       __aeabi_fsub
00002e  4606              MOV      r6,r0
000030  492e              LDR      r1,|L6.236|
000032  4620              MOV      r0,r4
000034  f7fffffe          BL       __aeabi_fmul
000038  4607              MOV      r7,r0
00003a  4631              MOV      r1,r6
00003c  f7fffffe          BL       __aeabi_fmul
000040  4605              MOV      r5,r0
000042  4829              LDR      r0,|L6.232|
000044  6801              LDR      r1,[r0,#0]  ; Thr_tmp
000046  4628              MOV      r0,r5
000048  f7fffffe          BL       __aeabi_fadd
00004c  4926              LDR      r1,|L6.232|
00004e  6008              STR      r0,[r1,#0]  ; Thr_tmp
;;;250    	Thr_Weight = LIMIT(Thr_tmp,0,1);    	//后边多处分离数据会用到这个值
000050  2100              MOVS     r1,#0
000052  4825              LDR      r0,|L6.232|
000054  6800              LDR      r0,[r0,#0]  ; Thr_tmp
000056  f7fffffe          BL       __aeabi_cfcmple
00005a  d201              BCS      |L6.96|
00005c  2000              MOVS     r0,#0
00005e  e00b              B        |L6.120|
                  |L6.96|
000060  f04f517e          MOV      r1,#0x3f800000
000064  4820              LDR      r0,|L6.232|
000066  6800              LDR      r0,[r0,#0]  ; Thr_tmp
000068  f7fffffe          BL       __aeabi_cfrcmple
00006c  d202              BCS      |L6.116|
00006e  f04f507e          MOV      r0,#0x3f800000
000072  e001              B        |L6.120|
                  |L6.116|
000074  481c              LDR      r0,|L6.232|
000076  6800              LDR      r0,[r0,#0]  ; Thr_tmp
                  |L6.120|
000078  491d              LDR      r1,|L6.240|
00007a  6008              STR      r0,[r1,#0]  ; Thr_Weight
;;;251    	
;;;252    ///////////////////////////////////////////////////////////////////////////////	
;;;253    
;;;254    	if( thr < 100 )
00007c  491d              LDR      r1,|L6.244|
00007e  4818              LDR      r0,|L6.224|
000080  6800              LDR      r0,[r0,#0]  ; thr
000082  f7fffffe          BL       __aeabi_cfcmple
000086  d203              BCS      |L6.144|
;;;255    	{
;;;256    		Thr_Low = 1;
000088  2001              MOVS     r0,#1
00008a  491b              LDR      r1,|L6.248|
00008c  7008              STRB     r0,[r1,#0]
00008e  e002              B        |L6.150|
                  |L6.144|
;;;257    	}
;;;258    	else
;;;259    	{
;;;260    		Thr_Low = 0;
000090  2000              MOVS     r0,#0
000092  4919              LDR      r1,|L6.248|
000094  7008              STRB     r0,[r1,#0]
                  |L6.150|
;;;261    	}
;;;262    	
;;;263    	#if(CTRL_HEIGHT)
;;;264    
;;;265    	Height_Ctrl(T,thr);
000096  4812              LDR      r0,|L6.224|
000098  6801              LDR      r1,[r0,#0]  ; thr
00009a  4620              MOV      r0,r4
00009c  f7fffffe          BL       Height_Ctrl
;;;266    
;;;267    	thr_value = Thr_Weight *height_ctrl_out;   //实际使用值
0000a0  4816              LDR      r0,|L6.252|
0000a2  6801              LDR      r1,[r0,#0]  ; height_ctrl_out
0000a4  4812              LDR      r0,|L6.240|
0000a6  6800              LDR      r0,[r0,#0]  ; Thr_Weight
0000a8  f7fffffe          BL       __aeabi_fmul
0000ac  4914              LDR      r1,|L6.256|
0000ae  6008              STR      r0,[r1,#0]  ; thr_value
;;;268    
;;;269    	#else
;;;270    	thr_value = thr;   //实际使用值
;;;271    
;;;272    	#endif
;;;273    
;;;274    	thr_value = LIMIT(thr_value,0,10 *MAX_THR *MAX_PWM/100);//限制油门最大为800，留200余地给姿态控制
0000b0  2100              MOVS     r1,#0
0000b2  4813              LDR      r0,|L6.256|
0000b4  6800              LDR      r0,[r0,#0]  ; thr_value
0000b6  f7fffffe          BL       __aeabi_cfcmple
0000ba  d201              BCS      |L6.192|
0000bc  2000              MOVS     r0,#0
0000be  e009              B        |L6.212|
                  |L6.192|
0000c0  4910              LDR      r1,|L6.260|
0000c2  480f              LDR      r0,|L6.256|
0000c4  6800              LDR      r0,[r0,#0]  ; thr_value
0000c6  f7fffffe          BL       __aeabi_cfrcmple
0000ca  d201              BCS      |L6.208|
0000cc  480d              LDR      r0,|L6.260|
0000ce  e001              B        |L6.212|
                  |L6.208|
0000d0  480b              LDR      r0,|L6.256|
0000d2  6800              LDR      r0,[r0,#0]  ; thr_value
                  |L6.212|
0000d4  490a              LDR      r1,|L6.256|
0000d6  6008              STR      r0,[r1,#0]  ; thr_value
;;;275    }
0000d8  e8bd81f0          POP      {r4-r8,pc}
                          ENDP

                  |L6.220|
                          DCD      RC_Data
                  |L6.224|
                          DCD      thr
                  |L6.228|
                          DCD      0x437a0000
                  |L6.232|
                          DCD      Thr_tmp
                  |L6.236|
                          DCD      0x41fb3334
                  |L6.240|
                          DCD      Thr_Weight
                  |L6.244|
                          DCD      0x42c80000
                  |L6.248|
                          DCD      Thr_Low
                  |L6.252|
                          DCD      height_ctrl_out
                  |L6.256|
                          DCD      thr_value
                  |L6.260|
                          DCD      0x44480000

                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  ctrl
                          %        220
                  Target
                          %        16

                          AREA ||.data||, DATA, ALIGN=2

                  Moto_duty
                          %        8
                  motor_array
                          DCD      Moto_duty
                  Thr_Weight
                          DCD      0x00000000
                  thr_value
                          DCD      0x00000000
                  Thr_Low
000014  00000000          DCB      0x00,0x00,0x00,0x00
                  thr
                          DCD      0x00000000
                  Thr_tmp
                          DCD      0x00000000
